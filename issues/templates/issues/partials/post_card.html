<!-- issues/partials/post_card.html -->

<!-- The main tweet-like card structure -->
<div class="tweet-card" data-post-id="{{ post.id }}">
    
    <!-- Tweet Header: Avatar, User Info, and Status Badge -->
    <div class="tweet-header">
        
        <!-- Avatar and User Info Group -->
        <div class="user-info-group">
            <div class="avatar">
                {% if post.user.profile.avatar %}
                    <img src="{{ post.user.profile.avatar.url }}" alt="{{ post.user.username }}" loading="lazy">
                {% else %}
                    <div class="avatar-initial">{{ post.user.username|first|upper }}</div>
                {% endif %}
            </div>
            <div class="user-details">
                <span class="username">{{ post.user.username }}</span>
                <div class="meta-info">
                    <span class="icon-location bi bi-geo-alt-fill"></span>
                    <span class="location-name">{{ post.location_name }}</span>
                    <span class="time-ago">â€¢ {{ post.created_at|timesince }} ago</span>
                </div>
            </div>
        </div>

        <!-- Status Badge -->
        <div class="status-badge status-{{ post.status|lower|cut:' ' }}">
            {{ post.status }}
        </div>
    </div>
    
    <!-- Post Body / Content -->
    <div class="tweet-body">
        <h2 class="post-title">{{ post.title }}</h2>
        <p class="post-description">{{ post.description }}</p>
    </div>

    <!-- Post Media (Image) -->
    {% if post.image %}
    <div class="post-media">
        <img src="{{ post.image.url }}" alt="{{ post.title }}" class="media-image" loading="lazy">
    </div>
    {% endif %}
    
    <!-- Actions Bar (Like, Comment, Save, Share) -->
    <div class="tweet-actions">
        
        <!-- Left: Like & Comment -->
        <div class="action-buttons">
            <!-- Like Button (HTMX powered) -->
            <button hx-post="{% url 'toggle_like' post.id %}"
                hx-target="closest .tweet-card"
                hx-swap="outerHTML"
                hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                class="action-btn like-btn {% if post.is_liked_by %}liked{% endif %}"
                title="{% if post.is_liked_by %}Unlike{% else %}Like{% endif %}">
                <i class="bi {% if post.is_liked_by %}bi-heart-fill{% else %}bi-heart{% endif %}"></i>
                <span class="action-count">{{ post.likes.count }}</span>
            </button>

            <!-- Comment Button -->
            <button class="action-btn comment-btn" onclick="openCommentModal('{{ post.id }}')" title="Comment">
                <i class="bi bi-chat"></i>
                <span class="action-count">{{ post.comments.count }}</span>
            </button>
        </div>

        <!-- Right: Save & Share -->
        <div class="utility-buttons">
            <!-- Save Button (HTMX powered) -->
            <form hx-post="{% url 'toggle_save_post' post.id %}" 
                  hx-target="closest .tweet-card"
                  hx-swap="outerHTML"
                  hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                  class="save-form">
                {% if post.id in saved_posts %}
                    <button type="submit" class="action-btn save-btn saved" title="Unsave">
                        <i class="bi bi-bookmark-fill"></i>
                    </button>
                {% else %}
                    <button type="submit" class="action-btn save-btn" title="Save">
                        <i class="bi bi-bookmark"></i>
                    </button>
                {% endif %}
            </form>

            <!-- Share Button -->
            <button type="button" class="action-btn share-btn" 
                onclick="copyToClipboard('{{ request.scheme }}://{{ request.get_host }}{% url 'post_detail' post.id %}')" 
                title="Share Post">
                <i class="bi bi-share"></i>
            </button>
        </div>
    </div>
</div>